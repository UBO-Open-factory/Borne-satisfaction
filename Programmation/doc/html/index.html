<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Borne Satisfaction: Programme microcontrolleur</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Borne Satisfaction<span id="projectnumber">&#160;1.0.6</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Programme microcontrolleur </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_D__Projets_Cool_Food_Pro_borne_satisfaction_Programmation_Microcontroleur_README"></a>Dans ce répertoire, se trouvent les programmes et librairies utilisées par l'ESP32.</p>
<h1><a class="anchor" id="autotoc_md20"></a>
Répertoires</h1>
<p ><b>doc</b> : the technical documetation of the ESP32 code (from Doxygen).</p>
<p ><b>Microcontroleur</b> : ESP32 programms</p>
<p ><b>test_borne_satisfaction</b> : ???? <a href="https://github.com/AlexP20000/borne-satisfaction/issues/24">#24</a></p>
<p ><b>tests</b> : Tests unitaires des différents composants de la carte mère (CarteSD, DeepSleep, Leds, Littelfs, RTC ).</p>
<hr  />
<h1><a class="anchor" id="autotoc_md22"></a>
Compilation du programme</h1>
<p >Afin de pouvoir compiler le programme, il est nécessaire d'installer <a href="https://www.arduino.cc/en/software">l'IDE Arduino</a> et les cartes ESP32.</p>
<h2><a class="anchor" id="autotoc_md23"></a>
Installation des cartes ESP32</h2>
<p >Dans les préférences de l'IDE Arduino (Fichier&gt;Préférences ou [Ctrl] + [,]), ajouter l'URL : </p><div class="fragment"><div class="line">![Ajout des cartes ESP32](./illustrations/Arduino_preferences.png)</div>
<div class="line"> </div>
<div class="line">Ensuite, dans le menu Tools &gt; Boards manager Recherchez &quot;ESP32&quot; et installez les cartes trouvées.</div>
<div class="line">![Ajout des cartes ESP32](./illustrations/Arduino_ESP32.png)</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Dans le menu Tools &gt; Boards, choississez la carte **FireBeetle-ESP32**</div>
<div class="line">![Choix de la carte ESP32](./illustrations/Arduino_CardChoice.png)</div>
<div class="line"> </div>
<div class="line">## Installation des librairies utiles à la compilation ##</div>
<div class="line">Toutes les librairies utiles se [trouvent ici](./libs/README.md)</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"># Fichiers sur la carte SD #</div>
<div class="line">La carte SD contient plusieurs type de fichiers :</div>
<div class="line">- Fichier de paramétrage (Modifiable par le **gestionnaire**)</div>
<div class="line">- Fichier d&#39;enregistrements des résultats (Généré par le programme).</div>
<div class="line">- Fichier de synthèse des résultats (Généré par le programme).</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">## Format des fichiers ##</div>
<div class="line"> </div>
<div class="line">### Fichier de configuration ###</div>
<div class="line">fichier : **configuration.ini** formaté comme suit :</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md24"></a>
Ceci est le fichier de configuration pour l'application 'Compteur de vote'.</h1>
<h1><a class="anchor" id="autotoc_md25"></a>
Ne modifiez pas le nom des variables (ce qui se trouve avant le signe egale sur une ligne).</h1>
<h1><a class="anchor" id="autotoc_md26"></a>
Vous pouvez modifier le texte se trouvant apres le signe egale a votre guise.</h1>
<p >#____________________________________________________________________________________________ [config]</p>
<h1><a class="anchor" id="autotoc_md27"></a>
Le siteID est votre identifiant comme il vous a ete donnee par l'enqueteur,</h1>
<h1><a class="anchor" id="autotoc_md28"></a>
ne le modifiez pas s'il ne vous le demande pas.</h1>
<p >siteID=Cool Food UOF</p>
<h1><a class="anchor" id="autotoc_md29"></a>
Cette phrase apparaitra dans le fichier resultat à votre questionnaire mais n'est pas visible sur la borne.</h1>
<h1><a class="anchor" id="autotoc_md30"></a>
Il est conseille de definir ici une phrase courte.</h1>
<p >question=Aimez-vous faire des tests sur cette borne ?</p>
<h1><a class="anchor" id="autotoc_md31"></a>
Si vous avez besoin de mettre la date à l'heure dans la borne, c'est ici.</h1>
<h1><a class="anchor" id="autotoc_md32"></a>
Pour la mise à l'heure, décommentez (supprimez le # en début de ligne) et</h1>
<h1><a class="anchor" id="autotoc_md33"></a>
remplissez les champs suivant avec des valeurs numériques uniquement.</h1>
<h1><a class="anchor" id="autotoc_md34"></a>
Une fois la mise à l'heure faite, les lignes seront automatiquement commentées.</h1>
<p >#year=2022 #month=04 #day=27 #hour=14 #minute=56 </p><div class="fragment"><div class="line">### Fichier de synthèse ###</div>
<div class="line">Fichier **YYYY-MM-DD_recap.txt** (par exemple 2022-04-27_recap.txt) formaté comme suit :</div>
</div><!-- fragment --><p> Etablissement = Cool Food I23I5V242Q Date = 2022/04/05 Question = Voulez vous manger un plat végétarien une fois par semaine ? Batterie = 96% Nombre d'appui sur les boutons : Rouge = 2 Vert = 4 Jaune = 3 TOTAL = 9 Pourcentage d'appui sur les boutons : Rouge = 22% Vert = 44% Jaune = 33%</p>
<p >```</p>
<h3><a class="anchor" id="autotoc_md35"></a>
Fichiers CSV</h3>
<p >Fichier <b>YYYY-MM-DD_detail.csv</b> (par exemple 2022-04-27_detail.csv) formaté comme suit :</p>
<p >Exemple d'un fichier 20220208_Mesures.csv</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">ID du site   </th><th class="markdownTableHeadNone">Date   </th><th class="markdownTableHeadNone">Heure   </th><th class="markdownTableHeadNone">Question   </th><th class="markdownTableHeadNone">Vert   </th><th class="markdownTableHeadNone">Rouge   </th><th class="markdownTableHeadNone">Jaune   </th><th class="markdownTableHeadNone">Niveau Batterie    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">OpenFactory   </td><td class="markdownTableBodyNone">08/02/2022   </td><td class="markdownTableBodyNone">12:45:52   </td><td class="markdownTableBodyNone">Aimez-vous les artichauds   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">90%    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">OpenFactory   </td><td class="markdownTableBodyNone">08/02/2022   </td><td class="markdownTableBodyNone">12:45:53   </td><td class="markdownTableBodyNone">Aimez-vous les artichauds   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">90%    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">OpenFactory   </td><td class="markdownTableBodyNone">08/02/2022   </td><td class="markdownTableBodyNone">12:45:55   </td><td class="markdownTableBodyNone">Aimez-vous les artichauds   </td><td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">90%    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">OpenFactory   </td><td class="markdownTableBodyNone">08/05/2022   </td><td class="markdownTableBodyNone">20:12:15   </td><td class="markdownTableBodyNone">Aimez-vous les artichauds   </td><td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">50%   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md36"></a>
Programmes</h1>
<h2><a class="anchor" id="autotoc_md37"></a>
Initialisation</h2>
<p >Le programme est fait (et testé) pour un micro-controlleur ESP32 sur un Firebeetle.</p>
<h2><a class="anchor" id="autotoc_md38"></a>
Codes couleur</h2>
<p >Les LEDS sont utilisées pour indiquer des alertes ou des erreurs lors de la mise sous tension de la borne.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Couleur   </th><th class="markdownTableHeadNone">Allumage LED   </th><th class="markdownTableHeadNone">Signification   </th><th class="markdownTableHeadNone">Bloquant    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Rouge   </td><td class="markdownTableBodyNone">Fixe   </td><td class="markdownTableBodyNone">Carte SD manquante   </td><td class="markdownTableBodyNone">Oui    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Rouge   </td><td class="markdownTableBodyNone">Clignotant   </td><td class="markdownTableBodyNone">Fichier configuration manquante   </td><td class="markdownTableBodyNone">Oui    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Jaune   </td><td class="markdownTableBodyNone">Bref   </td><td class="markdownTableBodyNone">Niveau de batterie &lt; 20%   </td><td class="markdownTableBodyNone">Non    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Jaune   </td><td class="markdownTableBodyNone">Clignotant   </td><td class="markdownTableBodyNone">Niveau de batterie &lt; 5%   </td><td class="markdownTableBodyNone">Non    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Jaune   </td><td class="markdownTableBodyNone">Clignotant (3x)   </td><td class="markdownTableBodyNone">Echec de la mise à l'heure   </td><td class="markdownTableBodyNone">Non    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Vert   </td><td class="markdownTableBodyNone">Clignotant (3x)   </td><td class="markdownTableBodyNone">Date et heure mise à jour à partir du fichier de configuration   </td><td class="markdownTableBodyNone">Non    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Vert   </td><td class="markdownTableBodyNone">Bref   </td><td class="markdownTableBodyNone">Tout est OK   </td><td class="markdownTableBodyNone">Non   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md39"></a>
Algorithme du microcontrôleur</h2>
<p ><img src="./illustrations/Diagrams.png" alt="Algorithme du microcontrôleur" class="inline"/> </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
